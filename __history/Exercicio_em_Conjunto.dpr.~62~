program Exercicio_em_Conjunto;

{$APPTYPE CONSOLE}  // Define que o programa será executado no console (terminal)
{$R *.res}

uses
  System.SysUtils;  // Biblioteca necessária para funções do sistema, como manipulação de strings, erros, etc.

// Procedimento que exibe o menu principal na tela
procedure MostrarMenu;
begin
  WriteLn('------- Menu -------');
  WriteLn('1 - Realizar Login ');
  WriteLn('2 - Realizar Cadastro ');
  WriteLn('9 - Sair');
  WriteLn('--------------------');
  WriteLn('Digite seu destino: ');
end;

function ValidaTamanho(Tamanho:Integer;Valor:string):Boolean;
begin
  if (Valor.Length < Tamanho) then begin
    Result:=False;
  end else begin
    Result:=True
  end;
end;

// Constantes com usuário e senha fixos (Admin)
const
  usuarioadmin: String = 'Admin';
  senhaadmin: String = 'Admin';

// Procedimento para realizar o cadastro do usuário
procedure MenuCadastro;
var
  nome, numero, usuario, senha: String;
  idade: Integer;
  tamanhoValido:Boolean;
begin
  WriteLn('Informe Seu Nome Completo');
  Readln(nome);

  Writeln('Informe Seu número telefônico ');
  Readln(numero);

  Writeln('Informe Sua Idade');
  Readln(idade);

  // Validação do nome de usuário (deve ter mais de 5 caracteres)


  while true do begin
  Writeln('Informe seu usuário');
  Readln(usuario);
  tamanhoValido:=ValidaTamanho(5,usuario);


  if tamanhoValido then begin
    break;
  end else begin
  Writeln('Obrigatorio ter mais de 5 caracteres');
  end;

  // Validação da senha (deve ter mais de 5 caracteres)
  Writeln('Informe sua senha');
  Readln(senha);
  ValidaTamanho(5,senha);
end;

// Função que verifica se o login inserido é o do administrador
function LoginValido(usuario, senha: String): Boolean;
begin
  Result := (usuario = usuarioadmin) and (senha = senhaadmin);
end;

// Variáveis principais usadas no programa
var
  usuario, senha, opcaoDoUsuario, validarsenha: String;
  destino: Boolean;

// Função de validação básica para checar se usuário e senha têm exatamente 5 caracteres
function Autenticacao(usuario, senha: String): Boolean;
begin
  result := (usuario.Length = 5) and (senha.Length = 5);
end;

begin
  try
    MostrarMenu;  // Exibe o menu pela primeira vez

    destino := true;  // Controla o laço principal do programa

    while destino do
    begin
      ReadLn(opcaoDoUsuario);  // Lê a opção digitada pelo usuário

      // Opção 1: Login
      if (opcaoDoUsuario = '1') then
      begin
        var destinoLogin: Boolean := true;

        while destinoLogin do
        begin
          WriteLn('Digite seu usuário');
          ReadLn(usuario);

          Writeln('Digite sua senha');
          ReadLn(senha);

          // Verifica se os dados têm tamanho válido
          if Autenticacao(usuario, senha) then
            Write('Dados válidos')
          else
            WriteLn('Dados inválidos');

          // Verifica se o login bate com as credenciais do admin
          if LoginValido(usuario, senha) then
          begin
            WriteLn('Autenticado com sucesso.');
            destino := false;
            destinoLogin := false;
          end
          else
          begin
            WriteLn('Credenciais incorretas, tente novamente!');
            destino := false;  // Aqui você está encerrando o loop principal mesmo se falhar
          end;
        end;
      end

      // Opção 2: Cadastro
      else if (opcaoDoUsuario = '2') then
      begin
        MenuCadastro;
      end

      // Opção 9: Encerrar programa
      else if (opcaoDoUsuario = '9') then
      begin
        WriteLn('Encerrando...');
        Sleep(1500);  // Aguarda 1,5 segundos
        exit;         // Encerra o programa
      end

      // Qualquer outra opção
      else
      begin
        WriteLn('Opção inválida, retornando o sistema...');
        MostrarMenu;
      end;

    end;

  except
    // Em caso de erro, exibe o tipo da exceção
    on E: Exception do
      Writeln(E.ClassName, ': ', E.Message);
  end;

  Readln;  // Aguarda usuário pressionar Enter antes de fechar
end.

